syntax = "proto3";

package proto;

import "google/protobuf/timestamp.proto";

service ApiService {
  rpc CreateSession(CreateSessionReq) returns (CreateSessionResp) {}
  rpc ValidateSession(ValidateSessionReq) returns (ValidateSessionResp) {}
  rpc DeleteSession(DeleteSessionReq) returns (DeleteSessionResp) {}

  rpc StartOauthLogin(StartOauthLoginReq) returns (StartOauthLoginResp) {}
  rpc HandleOauthCallback(HandleOauthCallbackReq) returns (HandleOauthCallbackResp);
  rpc LinkOauthAccount(LinkOauthAccountReq) returns (LinkOauthAccountResp) {}
  rpc GetOauthAccount(GetOauthAccountReq) returns (GetOauthAccountResp) {}
}

message Session {
  string token = 1;
}


message CreateSessionReq {
  string user_id = 1;
}

message CreateSessionResp {
    string token = 1;
}

message ValidateSessionReq {
  string token = 1;
}

message ValidateSessionResp {
  string user_id = 1;
  bool should_refresh_cookie = 2;
}

message DeleteSessionReq {
  string token = 1;
}

message DeleteSessionResp { }

enum OauthProvider {
    OAUTH_PROVIDER_UNSPECIFIED = 0;
    OAUTH_PROVIDER_GOOGLE = 1;
    OAUTH_PROVIDER_GITHUB = 2;
}

message StartOauthLoginReq {
  OauthProvider provider = 1;
}

message StartOauthLoginResp {
  string state = 1;
  string authorization_url = 2;
  string code_verifier = 3;
}

message HandleOauthCallbackReq {
  OauthProvider provider = 1;
  string code = 2;
  string code_verifier = 3;
}

message HandleOauthCallbackResp {
  string account_id = 1;
  string external_user_email = 2;
  string external_user_name = 3;
  string user_id = 4;
}

message LinkOauthAccountReq {
  string account_id = 1;
  string user_id = 2;
}

message LinkOauthAccountResp { }

message GetOauthAccountReq {
  string user_id = 1;
  OauthProvider provider = 2;
}

message GetOauthAccountResp {
  string access_token = 1;
}
